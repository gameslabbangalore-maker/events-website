<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Events</title>
  <style>
    :root {
      --accent-color-light: #0a75bc;
      --accent-color-dark: #fce029;
      --bg-dark: #121212;
      --text-dark: #fff;
      --text-light: #000;
      --card-padding-mobile: 12px;
      --card-padding-desktop: 20px;
    }

    /* Reset */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: var(--bg-dark);
      color: var(--text-dark);
    }

    /* Top Bar */
    .topbar-bleed {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: env(safe-area-inset-top);
      background: rgba(24, 24, 24, 0.3);
      backdrop-filter: blur(10px);
      z-index: 100;
    }

    .topbar {
      position: fixed;
      top: env(safe-area-inset-top);
      left: 0;
      right: 0;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(24, 24, 24, 0.3);
      backdrop-filter: blur(10px);
      z-index: 101;
    }

    /* Container */
    #events {
      margin-top: calc(env(safe-area-inset-top) + 60px);
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      padding: 20px;
    }

    /* Card */
    .card {
      position: relative;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.8); /* Dark black shadow */
      overflow: hidden;
      transition: transform 0.2s ease;
    }

    .card:hover {
      transform: translateY(-5px);
    }

    /* Media */
    .media img {
      width: 100%;
      height: 180px;
      object-fit: cover;
    }

    /* Card body */
    .card-body {
      padding: var(--card-padding-desktop);
    }

    .event-title {
      font-size: 1.4rem;
      font-weight: bold;
      color: var(--text-dark); /* Default dark theme */
    }

    body.light-theme .event-title {
      color: var(--text-light); /* Black in light theme */
    }

    /* Meta (Desktop only) */
    .meta {
      font-size: 0.9rem;
      color: #ccc;
      margin-top: 4px;
    }

    /* Location desktop */
    .location a {
      color: var(--accent-color-dark);
      text-decoration: none;
      font-size: 0.95rem;
    }

    body.light-theme .location a {
      color: var(--accent-color-light);
    }

    /* Mobile Info Line */
    .mobile-info {
      display: none;
    }

    /* Date Box (Mobile) */
    .card-date {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #222;
      border-radius: 8px;
      padding: 8px;
      text-align: center;
      width: 60px;
      height: 60px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .card-date .day {
      font-size: 1.3rem;
      font-weight: bold;
      color: var(--accent-color-dark);
    }

    .card-date .month {
      font-size: 0.9rem;
      font-weight: bold;
      color: var(--text-light); /* Black month text */
    }

    /* Footer */
    .card-footer {
      padding: var(--card-padding-desktop);
      text-align: right;
    }

    .book-btn {
      display: inline-block;
      background: var(--accent-color-dark);
      color: #fff; /* Book Now text always white */
      padding: 8px 16px;
      border-radius: 6px;
      text-decoration: none;
      font-weight: bold;
      transition: background 0.2s ease;
    }

    .book-btn:hover {
      background: #e5c020;
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      .card-body {
        padding: var(--card-padding-mobile);
      }

      .meta {
        display: none;
      }

      .location {
        display: none;
      }

      .mobile-info {
        display: block;
        margin-top: 6px;
        font-size: 0.9rem;
        color: #fff;
      }

      .mobile-info a {
        text-decoration: none;
        color: var(--accent-color-dark);
      }

      body.light-theme .mobile-info a {
        color: var(--accent-color-light);
      }
    }
  </style>
</head>
<body class="dark-theme">
  <div class="topbar-bleed"></div>
  <div class="topbar">
    <h1>Events</h1>
  </div>

  <div id="events"></div>

  <script>
    (async function () {
      const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT8h4Vw/pub?output=csv";
      const fallbackImage = "fallback.jpg";

      try {
        const res = await fetch(csvUrl);
        const data = await res.text();
        const rows = data.split("\n").slice(1);

        const container = document.getElementById("events");
        let upcomingCount = 0;

        rows.forEach(row => {
          const [name, date, time, locText, locLink, image, ticket] = row.split(",");

          if (!name || !date) return;

          const eventDateObj = new Date(date);
          const today = new Date();
          if (eventDateObj < today) return; // Skip past events
          upcomingCount++;

          const card = document.createElement("article");
          card.className = "card";

          // Media
          const media = document.createElement("div");
          media.className = "media";
          const img = document.createElement("img");
          img.loading = "lazy";
          img.src = image || fallbackImage;
          img.alt = name;
          img.onerror = () => img.src = fallbackImage;
          media.appendChild(img);
          card.appendChild(media);

          // Body
          const body = document.createElement("div");
          body.className = "card-body";

          const h = document.createElement("h3");
          h.className = "event-title";
          h.textContent = name;
          body.appendChild(h);

          // Desktop meta
          const meta = document.createElement("p");
          meta.className = "meta";
          meta.textContent = (date ? date : "") + ((date && time) ? " | " : "") + (time || "");
          body.appendChild(meta);

          // Desktop location
          if (locText || locLink) {
            const locP = document.createElement("p");
            locP.className = "location";
            const a = document.createElement("a");
            a.href = locLink || "#";
            a.target = "_blank";
            a.rel = "noopener noreferrer";
            a.textContent = locText;
            locP.appendChild(a);
            body.appendChild(locP);
          }

          // Mobile info line
          const mobileInfo = document.createElement("p");
          mobileInfo.className = "mobile-info";
          if (locText) {
            const a2 = document.createElement("a");
            a2.href = locLink || "#";
            a2.target = "_blank";
            a2.rel = "noopener noreferrer";
            a2.textContent = locText;
            mobileInfo.appendChild(a2);
          }
          if (locText && time) mobileInfo.appendChild(document.createTextNode(" | "));
          if (time) mobileInfo.appendChild(document.createTextNode(time));
          body.appendChild(mobileInfo);

          card.appendChild(body);

          // Mobile date box
          if (eventDateObj) {
            const dayNum = eventDateObj.getDate();
            const monthShort = eventDateObj.toLocaleString('en-US', { month: 'short' });
            const dateBox = document.createElement("div");
            dateBox.className = "card-date";
            dateBox.innerHTML =
              `<div class="day">${String(dayNum).padStart(2, '0')}</div>` +
              `<div class="month">${monthShort}</div>`;
            card.appendChild(dateBox);
          }

          // Footer
          const footer = document.createElement("div");
          footer.className = "card-footer";
          const btn = document.createElement("a");
          btn.className = "book-btn";
          btn.href = ticket;
          btn.target = "_blank";
          btn.rel = "noopener noreferrer";
          btn.textContent = "Book Now";
          footer.appendChild(btn);
          card.appendChild(footer);

          // Mobile tap opens ticket
          card.addEventListener('click', function (e) {
            if (e.target.closest('a')) return;
            if (window.innerWidth <= 768) {
              if (ticket && ticket !== "#") window.open(ticket, '_blank');
            }
          });

          container.appendChild(card);
        });

        if (upcomingCount === 0) container.innerHTML = '<p style="color:#bbb">No upcoming events.</p>';
      } catch (err) {
        console.error(err);
        document.getElementById("events").innerHTML = '<p style="color:#f66">Could not load events â€” check CSV link visibility and console for details.</p>';
      }
    })();
  </script>
</body>
</html>
